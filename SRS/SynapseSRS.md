# АПК Синапс. ПО. ТЗ

**Версия документа:** 1.0  
**Дата создания:** 11.11.2025  
**Статус:** Черновик

## 1. Назначение

1.1. Пуско-наладка, настройка, оперативное управление и автоматическая работа осветительного оборудования с применением стандарта DALI.

## 2. Функции комплекса

2.1. Пуско-наладочные работы с оборудованием, подключаемым к линии DALI.

2.2. Настройка режимов работы оборудования под требования пользователя.

2.3. Оперативное управление оборудованием.

2.4. Автоматическая работа освещения по датчикам присутствия и освещенности.

2.5. Работа оборудования по расписанию.

## 3. Термины и определения

3.1. **АПК** — аппаратно-программный комплекс.

3.2. **Контроллер** — устройство на базе микроконтроллера GD32F103RBT6, работающее с устройствами DALI.

3.3. **Прошивка** — firmware в контроллере.

3.4. **Телефон** — мобильное устройство, обеспечивающее пользовательский интерфейс АПК.

3.5. **Приложение** — интерфейсное мобильное приложение в телефоне.

3.6. **LLM** — Large Language Model (большая языковая модель).

3.7. **Локация** — помещение или часть помещения, с отдельно от других частей объекта организованной работой освещения.

## 4. Аппаратная архитектура АПК

4.1. В АПК входят контроллер и один, два или несколько телефонов.

4.2. Телефоны подключаются к контроллеру по Bluetooth.

4.3. С контроллером одновременно могут работать (быть подключены) несколько телефонов.

4.4. К контроллеру подключается 1 линия DALI, устройствами в которой управляет АПК.

## 5. Светильники

5.1. Количество светильников ограничено емкостью линии DALI: 64 шт.

5.2. Поддерживаемые типы светильников: реле, димм, RGB, TW.

## 6. Устройства управления

6.1. Количество устройств управления ограничено емкостью линии DALI: 64 шт.

6.2. Типы устройств управления: датчики присутствия и освещенности, кнопочные панели.

## 7. Датчики присутствия

7.1. Датчики присутствия используются для автоматического управления освещением в локациях.

## 8. Датчики освещенности

8.1. Датчики освещенности используются для автоматической регулировки яркости освещения в зависимости от уровня естественного освещения.

## 9. Настенные кнопки

9.1. Настенные кнопки используются для оперативного управления освещением без использования мобильного приложения.

## 10. Локации

10.1. Устройства распределяются по локациям.

10.2. Устройство должно входить в локацию и только в одну.

10.3. Количество локаций не ограничено.

## 11. Группы

11.1. Светильники в рамках локации могут быть объединены в группы.

11.2. Группы в АПК соответствуют DALI-группам и используют DALI-механизм групп.

11.3. Общее максимальное количество групп на все локации — 16.

11.4. Светильник может входить только в одну группу или быть вне групп.

11.5. Светильники, объединенные в группу, получают возможность группового управления.

## 12. Световые сцены

12.1. Сцены в АПК соответствуют DALI-сценам и используют DALI-механизм сцен.

12.2. 5 сцен (DALI-сцены 0..4) распространяются на все светильники в АПК.

12.3. По умолчанию сцены 0..4 — яркости всех светильников: 0, 25, 50, 75, 100 %.

12.4. 5 сцен (DALI-сцены 5..9) распространяются на все светильники в группах.

12.5. По умолчанию сцены 5..9 — яркости всех светильников в группах: 0, 25, 50, 75, 100 %.

12.6. С помощью приложения сценам 0..4 могут быть назначены произвольные яркости всех светильников АПК.

12.7. С помощью приложения сценам 5..9 для каждой из групп могут быть назначены произвольные яркости светильников, входящих в эти группы.

## 13. Прошивка

13.1. Возможность своего обновления с помощью приложения.

13.2. Программная кнопка на контроллере, сбрасывающая настройки прошивки (не исполняемый код) в заводское состояние.

13.3. Автоматическая работа по датчикам и расписанию при соответствующих флагах, выставленных в локациях.

13.4. Опрос текущего состояния устройств в периоды затишья.

13.5. При отправке устройствам команд на изменение состояния последующий опрос того, подействовали ли эти команды, не предполагается. Выстрелили сообразно стандартам DALI и забыли. Сказали светильнику включиться на 33, считаем, что он включился на 33. Кроме процедуры инициализации линии.

## 14. Прошивка. База данных (основные сущности)

14.1. В энергонезависимой памяти прошивки хранится текущее состояние устройств DALI плюс метаданные, необходимые для АПК.

14.2. CONTROLLER — таблица с одной записью (в отличие от приложения)

- NAME — название контроллера, показываемое в приложении.
- SERIAL_NUMBER — заводской серийный номер; 8 цифр.
- PASSWORD — пинкод; 4 цифры; заводской на коробке (или наклейке на корпусе).
- ICO_NUM — номер иконки, которую будет иметь контроллер в приложении; 0 — дефолтная, заводская.

14.3. LOCATIONS — локации

- NUM — порядковый номер локации.
- NAME — название локации.
- ICO_NUM — номер иконки, которую будет иметь локация в приложении; 0 — дефолтная, заводская.
- IS_AUTO — T/F — работает ли локация в автоматическом режиме по датчикам.
- IS_PRES_AUTO — T/F — работает ли локация в автоматическом режиме по датчикам присутствия.
- IS_BRIGHT_AUTO — T/F — работает ли локация в автоматическом режиме по датчикам освещенности.
- IS_SCHEDULE — T/F — включена ли в локации работа по расписанию.

14.4. GROUPS — группы светильников

- NAME — название группы.
- DALI_NUM — номер группы в DALI.
- LOCATION_ID — идентификатор локации.

14.5. LUMINAIRES — светильники

- NAME — название светильника.
- DALI_ADDR — короткий адрес DALI.
- LOCATION_ID — идентификатор локации.
- GROUP_ID — идентификатор группы; NULL, если не в группе.

14.6. PRES_SENSORS — датчики присутствия

- NAME — название датчика.
- DALI_ADDR — короткий адрес DALI.
- LOCATION_ID — идентификатор локации.
- DELAY — задержка выключения (секунды).

14.7. BRIGHT_SENSORS — датчики освещенности

- NAME — название датчика.
- DALI_ADDR — короткий адрес DALI.
- LOCATION_ID — идентификатор локации.
- BRIGHTNESS — пороговое значение освещенности.

14.8. BUTTON_PANELS — кнопочные панели

- NAME — название панели.
- DALI_ADDR — короткий адрес DALI.
- LOCATION_ID — идентификатор локации.

14.9. BUTTONS — кнопки

- NUM — номер кнопки на панели.
- BUTTON_PANEL_ID — идентификатор панели.
- DALI_INST — номер инстанса в DALI.
- ACTION_ID — действие по короткому нажатию.

14.10. ACTIONS — действия с устройствами; навешивается на нажатия кнопок, срабатывание датчиков, события расписания

- GROUP_ID — идентификатор группы; если действие на группу.
- LUMINAIRE_ID — идентификатор светильника; если действие на отдельный светильник.
- SCENE_ID — идентификатор сцены.
- VAL_BRIGHT — значение яркости.
- VAL_TW — значение температуры белого света.
- VAL_R — значение красного канала (для RGB).
- VAL_G — значение зеленого канала (для RGB).
- VAL_B — значение синего канала (для RGB).
- VAL_W — значение белого канала (для RGBW).

Раздел БД расписания см. в соответствующем разделе.

## 15. Прошивка. Расписание

15.1. Расписание задается в виде набора событий (EVENTS).

15.2. Расписание задается одно для всего контроллера.

15.3. Необходимость действий (ACTIONS) по событиям расписания (EVENTS) проверяется контроллером раз в 1 минуту.

15.4. Приоритет действий, навешенных на один момент времени, определяется порядком событий в списке событий расписания.

15.5. Если пользователь назначает действие с устройством на момент времени, уже отмеченный в расписании, приложение выводит предупреждение об этом с комментарием про приоритет.

15.6. EVENTS — события расписания

- DATE_EVERYDAY — T/F — ежедневное событие.
- DATE_DAYS — 'FFTFFFF' — событие по дням недели.
- DATE_SPECIFIC — конкретная дата.
- TIME — время события с точностью до минуты.
- SMOOTH — T/F — плавное изменение параметра от предыдущего значения (яркость, температура света).
- ACTION_ID — идентификатор действия.

15.7. При плавном изменении параметров (SMOOTH = T) изменение производится раз в 1 минуту.

## 16. Прошивка. ПНР

16.1. Инициализация линии DALI со сбросом настроек устройств к заводским по команде от приложения.

16.2. Передача в приложение текущего статуса инициализации устройств для информирования пользователя о ходе процесса.

16.3. Добавление новых устройств в линию без пересбора линии.

16.4. Замена вышедших из строя устройств без пересбора линии:

- подключение новых устройств к линии;
- поиск устройств;
- сопоставление их вышедшим из строя (с разрешением неоднозначностей пользователем);
- перенос старых настроек в новые устройства (название, короткий адрес DALI, FADETIME и т. д.).

## 17. Приложение

17.1. Приложение используется в первую очередь для ПНР и настройки. Задача оперативного управления лежит на настенных кнопках.

17.2. Структура локальной базы данных в приложении аналогична БД в контроллере.

17.3. В БД приложения хранятся данные всех актуальных контроллеров, к которым подключалось приложение.

17.4. При подключении к контроллеру приложение актуализирует соответствующие записи в своей БД.

17.5. Заход в контроллер возможен только при наличии bluetooth-соединения с контроллером.

17.6. При пропадании связи с контроллером приложение выкидывает пользователя в список контроллеров.
