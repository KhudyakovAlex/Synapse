<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Техническое задание - Synapse Documentation</title>
    <link rel="icon" type="image/png" href="../assets/img/Synapse_ico.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <script>
        window.mermaid = {
            startOnLoad: true,
            theme: "default",
            securityLevel: "loose"
        };
    </script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <!-- Logo Bar -->
    <div class="header" style="background: var(--accent-primary); padding: 20px 0; margin-bottom: 0;">
        <div class="header-container" style="max-width: 1400px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center;">
            <a href="../index.html" style="margin-left: 10px;">
                <img src="../assets/img/Synapse_black.png" alt="Synapse" style="height: 50px; display: block;">
            </a>
            <div style="display: flex; align-items: center; gap: 20px;">
                <a href="https://t.me/+az-cc3wBJssxNzcy" target="_blank" style="display: flex; align-items: center; color: white; text-decoration: none; transition: opacity 0.2s ease;">
                    <img src="../assets/img/telegram.svg" alt="Telegram" style="width: 24px; height: 24px; display: block;">
                </a>
                <a href="https://github.com/KhudyakovAlex/Synapse/blob/master/PRD\SynapsePRD.md" target="_blank" style="color: white; text-decoration: none; font-weight: 500; font-size: 1.1em; transition: opacity 0.2s ease; margin-right: 10px;">GitHub →</a>
            </div>
        </div>
    </div>

    <!-- Page Title -->
    <div class="page-title-container" style="max-width: 1400px; margin: 0 auto; padding: 40px 20px 20px 20px;">
        <h1 style="color: var(--accent-primary); font-size: 2.25em; margin: 0; padding-bottom: 15px; border-bottom: 3px solid var(--accent-primary); font-weight: normal;">Техническое задание</h1>
    </div>

    <!-- Main Container -->
    <div class="container" style="max-width: 1400px; margin: 0 auto; padding: 0 20px 60px 20px;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3>Содержание</h3>
            <ul>
                <!-- TOC will be auto-generated by JS -->
            </ul>
        </aside>

        <!-- Content -->
        <main class="content">
            
<p>АПК Синапс v1.0. ПО</p>
<p><strong>Последнее изменение:</strong> 12.12.2025, 10:37 МСК</p>
<h2 id="1-назначение">1. Назначение</h2>
<p>1.1. Пуско-наладка, настройка, оперативное управление и автоматическая работа осветительного оборудования с применением стандарта DALI.</p>
<h2 id="2-функции-комплекса">2. Функции комплекса</h2>
<p>2.1. Пуско-наладочные работы с оборудованием, подключаемым к линии DALI.</p>
<p>2.2. Настройка режимов работы оборудования под требования пользователя.</p>
<p>2.3. Оперативное управление оборудованием.</p>
<p>2.4. Автоматическая работа освещения по датчикам присутствия и освещенности.</p>
<p>2.5. Работа оборудования по расписанию.</p>
<h2 id="3-термины-и-определения">3. Термины и определения</h2>
<p>3.1. <strong>АПК</strong> — аппаратно-программный комплекс.</p>
<p>3.2. <strong>Контроллер</strong> — устройство на базе микроконтроллера GD32F103RBT6, работающее с устройствами DALI.</p>
<p>3.3. <strong>Устройство</strong> — DALI-устройство в линии: светильник, датчик, кнопочная панель.</p>
<p>3.4. <strong>Прошивка</strong> — firmware в контроллере.</p>
<p>3.5. <strong>Телефон</strong> — мобильное устройство, обеспечивающее пользовательский интерфейс АПК.</p>
<p>3.6. <strong>Приложение</strong> — интерфейсное мобильное приложение в телефоне.</p>
<p>3.7. <strong>LLM</strong> — Large Language Model (большая языковая модель).</p>
<p>3.8. <strong>Локация</strong> — помещение или часть помещения с отдельно от других частей объекта (контроллера) организованной работой освещения. В АПК все локации одного уровня. Иерархия локаций не предусмотрена.</p>
<p>3.9. <strong>Действие (ACTION)</strong> — изменение состояния системы освещения. Действие — произвольный набор из команд (SUBACTION):</p>
<ul>
  <li>включений сцен светильников, сцен групп, сцен локаций, сцен всего контроллера;
  </li>
  <li>установка температуры TW у отдельного светильника, группы, локации или всего контроллера;
  </li>
  <li>включений и выключений режима АВТО в локациях.
  </li>
</ul>
<p>Действия навешиваются на нажатия кнопок, сработки датчиков присутствия, события в расписании.  </p>
<p>3.10. <strong>Оперативное управление</strong> — ручная установка пользователем яркости, цвета и/или температуры света светильников; управление режимом АВТО в локациях.</p>
<p>3.11. <strong>Настройка</strong> — установка пользователем параметров устройств, активация/деактивация датчиков, задание расписания с целью приведения работы освещения под свои требования.</p>
<p>3.12. <strong>ПНР</strong> — первичное конфигурирование устройств после монтажа (инициализация линии DALI); установка параметров устройств, изменение которых конечными пользователями в процессе эксплуатации не предполагается (MIN LEVEL, MAX LEVEL и т. д.).</p>
<p>3.13. <strong>Режим АВТО</strong> — изменение освещения в локации на основе сигналов от датчиков. Включается/выключается тумблером на странице локации в приложении.</p>
<h2 id="4-пуско-наладка-настройка-и-оперативное-управление-разделение-понятий">4. Пуско-наладка, настройка и оперативное управление. Разделение понятий</h2>
<p>4.1. <strong>Пуско-наладка</strong></p>
<ul>
<li>Установка параметров у контроллера</li>
<li>Инициализация линии DALI.</li>
<li>Расширение линии DALI.</li>
<li>Замена устройств в линии DALI.</li>
<li>Создание локаций и распределение по ним устройств.</li>
<li>Установка параметров у DALI-устройств.</li>
<li>Создание групп светильников.</li>
<li>Назначение действий на присутствие и отсутствие датчиков присутствия.</li>
<li>Привязка датчиков освещённости к группам светильников.</li>
<li>Назначение действий на настенные кнопки.</li>
</ul>
<p>4.2. <strong>Настройка</strong></p>
<ul>
<li>Формирование, активация/деактивация расписания.</li>
<li>Сохранение световых сцен у светильников, групп.</li>
</ul>
<p>4.3. <strong>Оперативное управление</strong></p>
<ul>
<li>Включение световых сцен у светильников, групп, локаций, всего контроллера.</li>
<li>Изменение яркости, цвета, температуры света у отдельных светильников.</li>
<li>Активация/деактивация режима АВТО у локации.</li>
</ul>
<h2 id="5-аппаратная-архитектура-апк">5. Аппаратная архитектура АПК</h2>
<div class="mermaid" data-diagram-url="SynapsePRD_diagram_0.html">flowchart LR
    LLM[(LLM)]
    MOB1(Телефон 1)
    MOB2(Телефон 2)
    CON(Контроллер)
    DALI{{DALI-линия}}
    LUM((Светильник))
    SEN((Датчик))
    BUT((Кнопка))

    LLM <--TCP/IP--> MOB1
    LLM <--TCP/IP--> MOB2
    MOB1 <--Bluetooth--> CON
    MOB2 <--Bluetooth--> CON
    CON --- DALI
    DALI <---> LUM
    DALI <---> SEN
    DALI <---> BUT

    style MOB1 fill:#FA0,stroke:#A50
    style MOB2 fill:#FA0,stroke:#A50
    style CON fill:#FA0,stroke:#A50
</div>
<p>5.1. В АПК входят контроллер и один или несколько телефонов.</p>
<p>5.2. Телефоны подключаются к контроллеру по Bluetooth.</p>
<p>5.3. С контроллером одновременно могут работать (быть подключены) несколько телефонов.</p>
<p>5.4. К контроллеру подключается 1 линия DALI, устройствами в которой управляет АПК.</p>
<p>5.5. Телефон посредством интернет-соединения подключается к LLM, развернутой на сервере AWADA (или возможно в телефоне?).</p>
<h2 id="6-локации">6. Локации</h2>
<p>6.1. Устройства могут находиться в локациях или быть без локации (в корне контроллера).</p>
<p>6.2. При инициализации все найденные в линии DALI устройства помещаются в корень (без локации).</p>
<p>6.3. Создание локаций и распределение устройств по ним происходит по командам от приложения.</p>
<p>6.4. Количество локаций: до 16.</p>
<p>6.5. Все локации находятся на одном уровне, никакой многоуровневой иерархии не предусмотрено.</p>
<p>6.6. У контроллера есть общий флаг АВТО (главный выключатель автоматического режима). Если АВТО контроллера = выкл, сигналы от всех датчиков (присутствия и освещённости) игнорируются. Если АВТО контроллера = вкл, работают флаги АВТО отдельных локаций.</p>
<p>6.7. У каждой локации есть свой флаг АВТО (в пользовательском интерфейсе приложения — тумблер в соответствующей локации). Если АВТО локации = выкл, сигналы от датчиков, действующие на устройства в данной локации, игнорируются (при условии, что АВТО контроллера = вкл).</p>
<p>6.8. Устройства без локации (в корне) работают в автоматическом режиме, если АВТО контроллера = вкл.</p>
<h2 id="7-светильники">7. Светильники</h2>
<p>7.1. Количество светильников ограничено емкостью линии DALI: 64 шт.</p>
<p>7.2. Поддерживаемые типы светильников: реле (тип 7), диммируемые светодиодные (тип 6), RGB, RGBW, TW (все три последние - тип 8).</p>
<p>7.3. Светильник может находиться в одной из локаций или быть без локации (в корне контроллера).</p>
<h2 id="8-световые-сцены">8. Световые сцены</h2>
<p>8.1. Световые (цветовые) сцены в АПК соответствуют DALI-сценам и используют DALI-механизм сцен.</p>
<p>8.2. 5 сквозных сцен (DALI-сцены 0–4) распространяются на все светильники.</p>
<p>8.3. По умолчанию в сценах 0–4 светильники имеют:</p>
<ul>
  <li>яркость: 0, 25, 50, 75, 100%;
  </li>
  <li>цвет: красный с максимальной насыщенностью;
  </li>
</ul>
<p>8.4. Состояние светильников в сцены может сохраняться:</p>
<ul>
  <li>отдельным светильником;
  </li>
  <li>группой светильников.
  </li>
</ul>
<p>8.5. Команда на включение сцены может быть отдана пользователем:</p>
<ul>
  <li>отдельному светильнику;
  </li>
  <li>группе светильников;
  </li>
  <li>всем светильникам локации;
  </li>
  <li>всем светильникам контроллера.
  </li>
</ul>
<h2 id="9-группы-светильников">9. Группы светильников</h2>
<p>9.1. Группа может быть привязана к локации или быть без локации (в корне контроллера). Группа без локации может содержать только светильники без локации. Группа с локацией может содержать только светильники из этой же локации.</p>
<p>9.2. Группы в АПК соответствуют DALI-группам и используют DALI-механизм групп.</p>
<p>9.3. Общее максимальное количество групп (включая группы в корне и во всех локациях) — 16.</p>
<p>9.4. Светильник может входить только в одну группу или быть вне групп (чтобы отдельные светильники не занимали DALI-группы, которых на всех не хватит).</p>
<p>9.5. Светильники, объединённые в группу, получают возможность группового управления.</p>
<p>9.6. У светильников в группе остаётся возможность индивидуального управления и настройки.</p>
<h2 id="10-устройства-управления">10. Устройства управления</h2>
<p>10.1. Количество устройств управления ограничено емкостью линии DALI: 64 шт.</p>
<p>10.2. Типы устройств управления: датчики присутствия и освещенности, кнопочные панели.</p>
<h2 id="11-кнопочные-панели">11. Кнопочные панели</h2>
<p>11.1. Кнопочные панели — основной инструмент пользователя для оперативного управления освещением.</p>
<p>11.2. На <strong>короткое нажатие</strong> кнопки может быть повешено одно или несколько действий (ACTIONS, см. ниже):</p>
<ul>
  <li>Если действие одно — при нажатии на кнопку оно и случается;
  </li>
  <li>Если действий несколько — они выполняются перебором.
  </li>
</ul>
<p>11.3. На <strong>долгое нажатие</strong> можно повесить только одно действие (ACTION). При нажатии и удержании вкл/выкл АВТО-режима производится сразу, яркость светильников плавно меняется в направлении целевой сцены.</p>
<p>11.4. Действия можно вешать и на короткое, и на длинное нажатия одновременно.</p>
<h2 id="12-датчики-присутствия">12. Датчики присутствия</h2>
<p>12.1. На датчик навешиваются два действия (ACTIONS, см. ниже): на присутствия / на отсутствие.</p>
<p>12.2. Действие на отсутствие срабатывает, когда датчик регистрирует отсутствие присутствия.</p>
<p>12.3. Если есть желание деактивировать конкретный датчик присутствия — убираем у него действия.</p>
<p>12.4. Действие всех датчиков на отдельно взятую локацию может быть активировано/деактивировано тумблером АВТО у этой локации в приложении или настенной кнопкой с соответствующим ACTION Локация.Авто = OFF или через расписание.</p>
<p>12.5. Оперативное управление хотя бы одним светильником в локации временно переводит режим АВТО в этой локации в выключенное состояние. Возврат в режим Локация.Авто = ON в этом случае: любой датчик присутствия данной локации регистрирует присутствие (и при этом сразу отрабатывает действие, повешенное на присутствие в этом датчике);</p>
<h2 id="13-датчики-освещенности">13. Датчики освещенности</h2>
<p>13.1. К датчику может быть привязана одна и только одна группа светильников. Датчик и группа должны находиться в одной локации, либо оба должны быть без локации (в корне).</p>
<p>13.2. Группа светильников может быть привязана только к одному датчику.</p>
<p>13.3. Если есть желание деактивировать конкретный датчик освещённости — убираем у него привязку к группе.</p>
<p>13.4. Действие датчиков активируется/деактивируется: для датчиков в локации — тумблером АВТО локации (при условии АВТО контроллера = вкл); для датчиков в корне — тумблером АВТО контроллера. Управление через настенную кнопку или расписание.</p>
<p>13.5. Датчик по команде из приложения запоминает текущую освещённость как целевую для каждой из 5 сцен группы в момент сохранения каждой из сцен.</p>
<p>13.6. При привязке датчика освещенности к группе группа последовательно переводится в каждую из 5 сцен. В момент работы каждой сцены сохраняется её целевая освещённость (начальная установка).</p>
<p>13.7. Если при сохранении сцены (и, соответственно, задания целевой освещённости) светильник полностью выключен, он в подкрутке освещённости по датчику участвовать не будет.</p>
<p>13.8. Любое изменение яркости светильников в группе, отличное от включения одной из её 5 сцен, отключает подкрутку яркости в ней по датчику освещённости.</p>
<p>13.9. Включение у группы любым способом одной из её сцен переводит группу в режим поддержания целевой освещённости.</p>
<h2 id="14-действия">14. Действия</h2>
<p>14.1. Действие (ACTION) — набор из команд (SUBACTIONS):</p>
<ul>
  <li>включение сцены у отдельного светильника, группы, локации, корня или всего контроллера;
  </li>
  <li>установка температуры TW у отдельного светильника, группы, локации, корня или всего контроллера;
  </li>
  <li>включение/выключение режима АВТО у локации или контроллера.
  </li>
</ul>
<p>14.2. Навешиваются на нажатия кнопок, срабатывание датчиков присутствия, события расписания.</p>
<p>14.3. Действие может распространяться на любые локации и весь контроллера независимо от расположения инициирующего устройства.</p>
<h2 id="15-расписание">15. Расписание</h2>
<p>15.1. Расписание задается в виде набора событий (EVENTS), при возникновении каждого из которых выполняется действие (ACTION).</p>
<p>15.2. События могут быть ежедневными или назначаться на определённые дни недели.</p>
<p>15.3. Расписание одно для всего контроллера.</p>
<p>15.4. Расписание может быть активировано/деактивировано.</p>
<p>15.5. Необходимость действий (ACTIONS) по событиям расписания (EVENTS) проверяется контроллером раз в 1 минуту.</p>
<p>15.6. Если на одно время назначено и ежедневное событие и событие на день недели, сначала выполняется первое, затем второе.</p>
<p>15.7. На одно и то же время нельзя назначить два ежедневных событий и/или два события по дням недели.</p>
<p>15.8. Действие может производиться одномоментно (EVENTS.SMOOTH = F), когда параметры меняются шагово, и плавно (EVENTS.SMOOTH = T), когда параметры, меняемые у устройств, линейно изменяются от предыдущих значений к значениям, заданным в ACTIONS.</p>
<p>15.9. При плавном изменении параметров (SMOOTH = T) изменение производится раз в 1 минуту.</p>
<h2 id="16-контроллер">16. Контроллер</h2>
<p>16.1. Контроллер хранит константы:</p>
<ul>
  <li>серийник: XXXXXXXX (8 цифр);
  </li>
  <li>название в Bluetooth: SYNAPSE XXXXXXXX.
  </li>
</ul>
<p>16.2. Контроллер хранит переменные (меняются через приложение):</p>
<ul>
  <li>пароль: YYYY (4 цифры);
  </li>
  <li>название, под которым контроллер значится в приложении (по умолчанию SYNAPSE XXXXXXXX);
  </li>
  <li>номер иконки (по умолчанию дефолт — 0);
  </li>
  <li>флаг АВТО — главный выключатель автоматического режима (по умолчанию выкл).
  </li>
</ul>
<h2 id="17-прошивка">17. Прошивка</h2>
<p>17.1. Возможность обновления прошивки с помощью приложения.</p>
<p>17.2. Нижний светодиод мигает если идет работа с линией DALI.</p>
<p>17.3. Лесенка светодиодов загорается вся, если есть хотя бы одно bluetooth-соединение с телефоном. Иначе вся лесенка не горит.</p>
<p>17.4. Текущие дата и время для расписания. Обновляются из приложения при каждом подключении телефона к контроллеру.</p>
<p>17.5. Данные в контроллере делятся на:</p>
<ul>
<li><strong>Рабочие</strong> — для работы с оборудованием DALI; хранятся в структурах языка С; передаются в командах между прошивкой и приложением.</li>
<li><strong>Интерфейсные</strong> — для формирования интерфейса приложения (названия, номера иконок, расположение иконок и т. п.); хранятся единым блоком; передаются бинарным блоком между прошивкой и приложением.</li>
</ul>
<p>17.6. Программная кнопка на контроллере, сбрасывающая:</p>
<ul>
  <li><strong>долгим нажатием</strong> настройки прошивки (не исполняемый код) в заводское состояние;
  </li>
  <li><strong>коротким нажатием</strong> только пароль в заводской.
  </li>
</ul>
<p>17.7. Автоматическая работа по датчикам и расписанию при соответствующих флагах, выставленных в локациях.</p>
<p>17.8. Опрос текущего состояния устройств в периоды затишья.</p>
<p>17.9. При отправке устройствам команд на изменение состояния последующий опрос того, подействовали ли эти команды, не предполагается. Выстрелили сообразно стандартам DALI и забыли. Сказали светильнику включиться на 33, считаем, что он включился на 33.</p>
<h2 id="18-прошивка-пнр">18. Прошивка. ПНР</h2>
<p>18.1. Инициализация по команде от приложения линии DALI со сбросом настроек устройств к состоянию RESET.</p>
<p>18.2. При инициализации кроме DALI-настроек удаляются все локации (и создаётся одна, в которую все вновь найденные устройства складируются), устройства, группы, расписание.</p>
<p>18.3. Передача в приложение текущего статуса инициализации устройств для информирования пользователя о ходе процесса.</p>
<p>18.4. Перед инициализацией все светильники широковещательно выключаются (у кнопок выключаются светодиоды). После успешной выдачи устройству короткого адреса DALI: светильник включается (у кнопок включаются светодиоды).</p>
<p>18.5. Добавление новых устройств в линию без пересбора линии.</p>
<p>18.6. Замена вышедших из строя устройств без пересбора линии:</p>
<ul>
  <li>подключение новых устройств к линии;
  </li>
  <li>поиск устройств;
  </li>
  <li>сопоставление их вышедшим из строя;
  </li>
  <li>перенос старых настроек в новые устройства (название, короткий адрес DALI, FADETIME и т. д.).
  </li>
</ul>
<h2 id="19-приложение">19. Приложение</h2>
<p>19.1. Версии приложения — Android, iOS.</p>
<p>19.2. Светлая и тёмная темы интерфейса.</p>
<p>19.3. Только вертикальная ориентация.</p>
<p>19.4. Приложение используется в первую очередь для ПНР и настройки. Задача оперативного управления лежит на настенных кнопках.</p>
<p>19.5. Структура локальной базы данных в приложении аналогична БД в контроллере.</p>
<p>19.6. В БД приложения хранятся данные всех актуальных контроллеров, к которым подключалось приложение.</p>
<p>19.7. При подключении к контроллеру приложение актуализирует соответствующие записи в своей БД.</p>
<p>19.8. Заход в контроллер возможен только при наличии Bluetooth-соединения с контроллером.</p>
<p>19.9. При пропадании связи с контроллером и после нескольких безуспешных попыток её восстановить приложение выкидывает пользователя в список контроллеров.</p>
<p>19.10. При появлении связи с контроллером, из которого вылетели по причине пропадания связи, заходим в него автоматом в прежнюю локацию (если не успели зайти в другой контроллер).</p>
<p>19.11. Перекодировки из человеческой шкалы 0..100 в нечеловеческую 0..255, равно как и из HSB в RGB, производятся в приложении в момент сохранения значений в базу. В базе значения RGB(W) разложены в R, G и B (W).</p>
<h2 id="20-приложение-основные-страницы">20. Приложение. Основные страницы</h2>
<p>20.1. <strong>Настройки приложения</strong> — переключение тем интерфейса, не включённые разрешения Андроида (с переходом на их включение).</p>
<p>20.2. <strong>Список контроллеров</strong> — старые и вновь найденные контроллеры, выбор контроллера для подключения.</p>
<p>20.3. <strong>Контроллер</strong> — список локаций контроллера, оперативное управление всеми светильниками, расписание.</p>
<p>20.4. <strong>Настройки контроллера</strong> — название, иконка, пароль, инициализация/расширение линии, обновление прошивки контроллера, удаление контроллера.</p>
<p>20.5. <strong>Локация</strong> — оперативное управление светильниками локации, переход на страницы светильников, датчиков и кнопок локации, расписание, АВТО/НЕАВТО.</p>
<p>20.6. <strong>Настройки локации</strong> — название, иконка, перемещение иконок светильников, формирование групп светильников, перемещение устройств между локациями.</p>
<p>20.7. <strong>Светильник</strong> — расширенное оперативное управление.</p>
<p>20.8. <strong>Настройки светильника</strong> — группа, название, иконка, DALI-параметры, удаление светильника.</p>
<p>20.9. <strong>Группа светильников</strong> — оперативное управление группой, сохранение сцен для группы.</p>
<p>20.10. <strong>Настройки группы светильников</strong> — название, сгруппированные светильники, удаление группы.</p>
<p>20.11. <strong>Настройки датчика присутствия</strong> — задержка (HOLD_TIME), назначение действий при срабатывании, название, DALI-параметры, удаление датчика.</p>
<p>20.12. <strong>Настройки датчика освещённости</strong> — управляемая группа светильников, название, DALI-параметры, удаление датчика.</p>
<p>20.13. <strong>Настройки кнопочной панели</strong> — назначение действий на кнопки, название, удаление панели.</p>
<p>20.14. <strong>Расписание</strong> — редактирование расписания.</p>
<h2 id="21-приложение-подключение-к-контроллеру">21. Приложение. Подключение к контроллеру</h2>
<p>21.1. При заходе в приложение — список контроллеров:</p>
<ul>
  <li>контроллеры, к которым уже было подключение на этом телефоне, независимо от того, на связи они в данный момент или нет (нужен признак — на связи или нет). Иконка и название не дефолтные (если менялись);
  </li>
  <li>найденные новые по признаку названия "SYNAPSE XXXXXXXX" Bluetooth-устройства (где XXXXXXXX — серийный номер контроллера). С таким дефолтным названием и дефолтной иконкой. (Проверить возможность вывода новых устройств тоже с изменёнными названиями и иконками, если кто-то уже их настраивал. В названии Bluetooth-устройства, как оно видно в списке таких устройств в телефоне, оставлять начало "SYNAPSE" всегда, дальше добавлять номер иконки, дальше наименование. Парсить это и выводить в нашем приложении как у подключавшихся контроллеров.)
  </li>
</ul>
<p>21.2. При подключении к новому контроллеру запрашивается пароль.</p>
<p>21.3. Заводской пароль указывается на упаковке контроллера или на его корпусе.</p>
<p>21.4. Зашедший в контроллер пользователь может поменять пароль.</p>
<p>21.5. Сброс к заводским настройкам сбрасывает пароль на заводской.</p>
<p>21.6. При следующих подключениях к контроллеру пароль не запрашивается.</p>
<p>21.7. Контроллер можно удалить из списка. При следующем поиске он появится среди вновь найденных.</p>
<p>21.8. Контроллеру можно назначить другое имя и пиктограмму. Имя и пиктограмма (номер) хранятся в контроллере.</p>
<p>21.9. Если при предыдущем закрытии приложения пользователь находился в контроллере в какой-то локации и при запуске приложения этот контроллер доступен, приложение автоматически заходит в этот контроллер и в эту локацию.</p>
<h2 id="22-приложение-пнр">22. Приложение. ПНР</h2>
<p>22.1. Находясь в контроллере, пользователь может запустить процесс инициализации линии DALI.</p>
<p>22.2. После отправки команды инициализации на контроллер показывается прогресс инициализации, любые действия с контроллером до её окончания невозможны, пользователь может выйти из контроллера или закрыть приложение (инициализацию проводит контроллер автономно).</p>
<p>22.3. Возможно расширение линии за счёт вновь подключенных устройств. Устройства добавляются с дефолтными параметрами в новую локацию.</p>
<p>22.4. Если устройство вышло из строя (что должно быть показано на иконке устройства), пользователь может, зайдя в настройки устройства, осуществить привязку нового экземпляра на старое место (если он по типу совпадает).</p>
<p>22.5. Установка ПНР-параметров DALI-устройств на соответствующих страницах настроек.</p>
<h2 id="23-приложение-llm">23. Приложение. LLM</h2>
<p>23.1. Общение с LLM идёт в текстовом или голосовом формате (в обе стороны).</p>
<p>23.2. При каждом запросе вместе с сообщением пользователя LLM передаются:</p>
<ul>
<li>
<p>Системный промпт с уставом свето-нейро-службы.</p>
</li>
<li>
<p>JSON с текущим состоянием системы освещения данного контроллера.</p>
</li>
</ul>
<p>23.3. LLM выполняет следующие функции:</p>
<ul>
<li>
<p>Консультирование по работе системы: FAQ, ответы на вопросы типа: "А почему у меня в этой локации эти светильники не ...".</p>
</li>
<li>
<p>Хэлп по работе с интерфейсом приложения (с переходом по запросу пользователя на нужные страницы интерфейса).</p>
</li>
<li>
<p>Экскурсия по интерфейсу с объяснением назначения страниц и кнопочек.</p>
</li>
<li>
<p>ПНР: инициализация и расширение линии DALI, создание локаций и групп светильников, подбор подходящих иконок и т. п.</p>
</li>
<li>
<p>Настройка: изменение настроек у устройств (в том числе групповое), формирование расписания (в том числе TW) и т. п.</p>
</li>
<li>
<p>Оперативное управление: изменение яркости, цвета и температуры у любого подмножества светильников.</p>
</li>
<li>
<p>Помощь пользователю в различных ситуациях в режиме визарда.</p>
</li>
<li>
<p>Подсказки пользователю при настройке стандартных кейсов локаций: кухня, спальня, гостиничный номер и т. п.</p>
</li>
<li>
<p>Копирование настроек между однотипными локациями, группами светильников и т. п.</p>
</li>
<li>
<p>Распространение настроек устройства на все устройства такого типа.</p>
</li>
</ul>
<p>23.4. Использование LLM должно полностью покрывать функционал кнопочного интерфейса и ускорять процесс настройки за счёт групповых и повторяющихся действий.</p>
<h2 id="24-юзкейсы">24. Юзкейсы</h2>
<p>24.1. <strong>Толчок</strong></p>
<p><em>Что имеем</em><br />
2 светильника. Датчиков нет. 1 кнопка.</p>
<p><em>Как управляем</em><br />
Кнопка.Короткое — Локация.Сцена4 / Локация.Сцена0</p>
<p>24.2. <strong>Гардероб</strong></p>
<p><em>Что имеем</em><br />
6 светильников. Датчик.</p>
<p><em>Как управляем</em><br />
До: ничего<br />
Дп: нет — Локация.Сцена0 / есть — Локация.Сцена4</p>
<p>24.3. <strong>Кухня</strong></p>
<p><em>Что имеем</em><br />
Свет1–Свет8 — основной свет<br />
Свет9 — подсветка под шкафами<br />
Свет10–Свет12 — свет над столом<br />
Кнопка1–Кнопка4<br />
Д1, Д2 (с блендой)  </p>
<p><em>Как управляем</em><br />
Свет1–Свет8 — Гр1<br />
Свет10–Свет12 — Гр2<br />
Д1п: нет — Гр1.Сцена0, Гр2.Сцена0 / есть — Гр1.Сцена4, Гр2.Сцена4 (выкл/вкл)<br />
Д1о: Гр1 (основной свет)<br />
Д2п: нет — Свет9.Сцена0 / есть — Свет9.Сцена4 (подсветка под шкафами)<br />
Д2о: ничего<br />
Кнопка1.Короткое — Гр1.Сцена4, Гр2.Сцена4 (вкл)<br />
Кнопка2.Короткое — Локация.Сцена0 (выкл всё)<br />
Кнопка3.Короткое — Локация.Сцена1 (Романтик)<br />
Кнопка4.Короткое — Свет9.Сцена0 / Свет9.Сцена4 (подсветка под шкафами)</p>
<p>24.4. <strong>Кабинет директора</strong></p>
<p><em>Что имеем</em><br />
Свет1–Свет9 — основной свет<br />
Свет10–Свет13 — свет над столом совещаний<br />
Свет14–Свет15 — свет над рабочим столом<br />
Свет16 — подсветка портрета Путина<br />
Кнопка1–Кнопка4<br />
Д1</p>
<p><em>Как управляем</em><br />
Свет1–Свет9 — Гр1<br />
Свет10–Свет13 — Гр2<br />
Свет14–Свет15 — Гр3<br />
Д1п: нет — Гр1.Сцена0, Гр2.Сцена0, Гр3.Сцена0, Свет16.Сцена1 / есть — Гр1.Сцена4, Гр3.Сцена4, Свет16.Сцена4 (выкл/вкл)<br />
Д1о: Гр1 (основной свет)<br />
Кнопка1.Короткое — Гр1.Сцена4, Гр3.Сцена4 (вкл)<br />
Кнопка2.Короткое — Гр1.Сцена0, Гр2.Сцена0, Гр3.Сцена0, Свет16.Сцена1 (выкл всё)<br />
Кнопка3.Короткое — Локация.Сцена1, Локация.Авто=OFF (Ночной режим)<br />
Кнопка4.Короткое — Гр2.Сцена0 / Гр2.Сцена4 (над столом совещаний)</p>
<p>24.5. <strong>Коридор</strong></p>
<p><em>Что имеем</em><br />
Д1<br />
Свет1–Свет3 — сегмент 1<br />
Д2<br />
Свет4–Свет6 — сегмент 2<br />
Д3<br />
Свет7–Свет9 — сегмент 3<br />
Д4</p>
<p><em>Как управляем</em><br />
Свет1–Свет3 — Гр1<br />
Свет4–Свет6 — Гр2<br />
Свет7–Свет9 — Гр3<br />
Д1о: Гр1<br />
Д2о: Гр2<br />
Д3о: Гр3<br />
Д1п: нет — Гр1.Сцена0 / есть — Гр1.Сцена4<br />
Д2п: нет — Гр1.Сцена0, Гр2.Сцена0 / есть — Гр1.Сцена4, Гр2.Сцена4<br />
Д3п: нет — Гр2.Сцена0, Гр3.Сцена0 / есть — Гр2.Сцена4, Гр3.Сцена4<br />
Д4п: нет — Гр3.Сцена0 / есть — Гр3.Сцена4</p>
<p>24.6. <strong>Номер гостиницы</strong></p>
<p><em>Что имеем</em><br />
Свет1–Свет2 — прихожая<br />
Свет3–Свет6 — комната<br />
Свет7–Свет10 — санузел<br />
Свет11, Свет12 — бра у кровати<br />
Д1 — прихожая<br />
Д2 — комната<br />
Д3 — санузел<br />
Кнопка1–Кнопка4 — прихожая<br />
Кнопка5–Кнопка6 — у кровати 1<br />
Кнопка7–Кнопка8 — у кровати 2</p>
<p><em>Как управляем</em><br />
Свет1–Свет2 — Гр1<br />
Свет3–Свет6 — Гр2<br />
Свет7–Свет10 — Гр3<br />
Д1п: нет — Гр1.Сцена0 / есть — Гр1.Сцена4<br />
Д2п: нет — Гр2.Сцена0 / есть — Гр2.Сцена4<br />
Д3п: нет — Гр3.Сцена0 / есть — Гр3.Сцена4<br />
Д1о: Гр1<br />
Д2о: Гр2<br />
Д3о: нет<br />
Кнопка1.Короткое — Гр1.Сцена0 / Гр1.Сцена4 (прихожая)<br />
Кнопка2.Короткое — Гр2.Сцена0 / Гр2.Сцена4 (комната)<br />
Кнопка3.Короткое — Гр3.Сцена0 / Гр3.Сцена4 (санузел)<br />
Кнопка4.Короткое — Локация.Авто=OFF / Локация.Авто=ON (ночной режим)<br />
Кнопка5.Короткое — Свет11.Сцена4 (бра 1)<br />
Кнопка6.Короткое — Свет11.Сцена0 (бра 1)<br />
Кнопка5.Длинное — Свет11.Сцена4 (бра 1)<br />
Кнопка6.Длинное — Свет11.Сцена0 (бра 1)<br />
Кнопка7.Короткое — Свет12.Сцена4 (бра 2)<br />
Кнопка8.Короткое — Свет12.Сцена0 (бра 2)<br />
Кнопка7.Длинное — Свет12.Сцена4 (бра 2)<br />
Кнопка8.Длинное — Свет12.Сцена0 (бра 2)  </p>
<h2 id="25-перспектива">25. Перспектива</h2>
<p>25.1. Интеграция с колонками Алиса.</p>
<p>25.2. Виджет у мобильного приложения.</p>
<p>25.3. Связь телефона с контроллером по Wi-Fi и ZigBee.</p>
<h2 id="26-вопросы">26. Вопросы</h2>
<p>26.1. Должна ли температура света включаться в сцены (сейчас не включена)?</p>
<h2 id="27-идеи">27. <a href="../PRD/Идеи.html">Идеи</a></h2>
<p>27.1. Долгим нажатием на настенную кнопку сохранять сцену.</p>
<p>27.2. Можно делать это в режиме диалога с ИИ и сохранять шторы и т. п. Тогда и без долгого нажатия.</p>
<p>27.3. Должна ли прошивка работать с LLM?</p>
<p>27.4. Рисовать планировку на основе расположения иконок локаций и площадей локаций, рассчитанных по яркости и количеству светильников.</p>
        </main>
    </div>

    <script src="../assets/js/main.js"></script>
</body>
</html>
