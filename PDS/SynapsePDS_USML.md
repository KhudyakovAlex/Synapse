# Unit System Model Language

АПК Синапс v1.0. ПО. Спецификации на разработку

**Последнее изменение:** 27.11.2025

## 1. Термины и определения

1.1. **USML** (Unit System Model Language) — система команд (телеграмм) для передачи данных в рамках АПК Синапс. Предназначен для общения LLM, мобильного приложения и прошивки контроллера.

1.2. **Телеграмма**, она же **телега** — название команды в USML, названная так, дабы отличать их от других команд.

1.3. **Внешние телеграммы** — телеграммы между телефоном и контроллером.

1.4. **Внутренние телеграммы** — телеграммы между программными модулями USM и UI в приложении и LLM.

## 2. Общие моменты

2.1. Обмен телеграммами:

```mermaid
flowchart LR
    LLM(LLM)

    subgraph Телефон
        UI(UI)
        USM(USM)
        R(R)
        C{{C}}
    end
  
    subgraph Контроллер
        FW(FW)
    end

    LLM<-->R
    R<-->UI
    R<-->USM
    R<-->C
    C<-->FW
```

Где:  

USM - база данных, содержащая модель системы устройств в линии DALI  
LLM - нейронка  
UI - пользовательский кнопочный интерфейс  
C - конвертер НОРМАЛЬНЫЕ_ТЕЛЕГИ / ТЕЛЕГИ_FW  
FW - firmware, прошивка в контроллере  

2.2. Телеграммы в формате, описанном ниже, имеют хождение только со стороны приложения до конвернера. В конвертере они и на вход и на выход переконвертируются в формат одному богу и отделу Саеко известный.

## 3. Формат телеграмм

3.1. Телега представляет собой текстовый блок, начинающийся с символа [ и заканчивающийся ].

3.2. Встречающиеся в теле телеги [ и ] экранируются "\" перед ними.

3.3. Тело телеги имеет вид XXX.YYY_ZZZ(P1,P2,...Pn), где:
- XXX — адресат: LLM, UI, USM или FW
- YYY — объект: CONTR, LUM, PSENS, BSENS и т.д.
- ZZZ — действие: GET, SET и т.п.
- P — параметры (их набор зависит от трёх позиций выше) имеют следующие типы:
  - NM - целые числа в виде текстовых последовательностей цифр: 123;
  - TX - тексты, помещённые в двойные кавычки: "Лампочка 12" (кавычки в тексте экранируются \");
  - TF - T / F: T
  - DT - бинарные блоки в Base64.

3.4. Пример телеги: [FW.CONTR_SET(25,"Этаж 2",IGlzIGRpc3Rpbmd1aXNoZWQsIG5vdC)]

3.7. Парсер принимает и понимает очередной элемент в телеге на основе последовательности ранее принятых элементов. Например:  

[  
**FW** — прошивка должна  
**CONTR** — у контроллера  
**SET** — установить  
**25** — иконку с №25  
**"Этаж 2"** — название контроллера "Этаж 2"  
**IGlzIGRpc3Rpbmd1aXNoZWQsIG5vdC** — в блок с интерфейсными данными записать IGlzIGRpc3Rpbmd1aXNoZWQsIG5vdC  
]  

## 3. Телеграммы к FW - работа с прошивкой

3.1 **CONTR** (1) - работа с контроллером  

Действия:  

**GET**  - запрос всех данных контроллера  
Параметры: без параметров  
Пример: [FW.CONTR_GET()]  

**SET** - изменение данных контроллера  
Параметры: TX NAME, TX PASSWORD, TF IS_SCHEDULE, NM ICO_NUM, DT INTERFACE_DATA  
Пример: [FW.CONTR_SET("Офис","1234",F,8,IGRpc3Rpb)]  

## 4. Телеграммы к USM - работа с USM

## 5. Телеграммы к UI - работа с пользовательским интерфейсом

## 6. Телеграммы к LLM - работа с нейросеткой через чат 

## 7. Вопросы

## 8. Идеи
