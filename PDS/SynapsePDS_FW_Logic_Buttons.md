# Прошивка. Логика работы. Управление настенными кнопками

АПК Синапс v1.0. ПО. Спецификации на разработку

**Последнее изменение:** 14.12.2025, 13:26 МСК

Здесь описывается логика обработки сигналов от настенных кнопок без фиксации при коротком и долгом нажатии, т.е. логика оперативного управления через настенные кнопки.

## 1. Короткое нажатие

1.1. При коротком нажатии кнопки прошивка получает событие от DALI.

1.2. Прошивка хранит для каждой кнопки текущую позицию действия (не в USM, а в оперативной памяти, хранить на случай отключения питаия контроллера не надо).

1.3. При любом изменении пользователем набора действий повешенных на кнопку, текущую позицию действия надо сбрасывать в 1.

1.4. При первом нажатии позиция = 1. Если действие одно — позиция всегда = 1.

1.5. Прошивка находит действие с **ACTIONS.BUTTON_SHORT_ID** = `i` и **POS** = текущая позиция.

1.6. Прошивка выполняет найденное действие. Сохраняет изменения в FW-USM и отправляет их приложению (если есть подключённые телефоны).

1.7. После выполнения прошивка увеличивает текущую позицию. Если следующей позиции нет — начинает с 1 (новый круг).

## 2. Долгое нажатие

2.1. При долгом нажатии кнопки прошивка получает сигнал от DALI.

2.2. Прошивка находит действие с **ACTIONS.BUTTON_LONG_ID** = `i`.

2.3. Если такого действия нет, забываем про этот сигнал от DALI.

2.4. Прошивка берёт текущее состояние светильников, к которым имеет отношение действие.

2.5. В течение всего времени удержания кнопки нажатой прошивка с определённой захардкоженной скоростью изменяет состояние светильников в направлении заданного в действии (диммирование с кнопок).

2.6ы. Прошивка сохраняет изменения в FW-USM и отправляет их приложению (если есть подключённые телефоны) после отпускания кнопки.

