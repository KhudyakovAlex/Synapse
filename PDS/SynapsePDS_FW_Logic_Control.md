# Прошивка. Логика работы. Оперативное управление

АПК Синапс v1.0. ПО. Спецификации на разработку

**Последнее изменение:** 12.12.2025, 12:26 МСК

## 1. Назначение документа

Описать логику оперативного управления системой освещения через прошивку контроллера.

## 2. Базовые документы

- **SynapsePDS_FW_Logic** — базовые принципы логики работы прошивки
- **SynapsePDS_FW_DB** — структура базы данных прошивки
- **SynapsePDS_USML** — протокол обмена данными

## 3. Оперативное управление

### 3.1. Изменение яркости, цвета, температуры светильника

3.1.1. Приложение отправляет телеграмму с изменением полей светильника:
- **LUMINAIRES[i].VAL_BRIGHT** = значение яркости;
- **LUMINAIRES[i].VAL_TW** = температура белого;
- **LUMINAIRES[i].VAL_R**, **VAL_G**, **VAL_B**, **VAL_W** = цвета.

3.1.2. Прошивка отправляет DALI-команду установки параметров светильнику.

3.1.3. Если светильник находится в локации с включённым АВТО, оперативное управление временно переводит **LOCATIONS[loc].IS_AUTO** = `F`.

3.1.4. Возврат в режим АВТО происходит при срабатывании датчика присутствия в этой локации.

### 3.2. Включение сцены

3.2.1. Включение сцены может быть:
- У отдельного светильника;
- У группы светильников;
- У локации (всех светильников локации);
- У корня (всех светильников в корне);
- У всего контроллера (всех светильников контроллера).

3.2.2. Приложение отправляет телеграмму с изменением:
- **LUMINAIRES[i].SCENE_NUM** = N (для светильника);
- **GROUPS[i].SCENE_NUM** = N (для группы);
- **LOCATIONS[i].SCENE_NUM** = N (для локации);
- **CONTROLLERS.SCENE_NUM** = N (для контроллера).

3.2.3. Прошивка:
- Отправляет DALI-команду включения сцены N соответствующим устройствам;
- Обновляет поля VAL_BRIGHT, VAL_TW и т.д. из таблицы **SCENE_LUMINAIRES**;
- Обновляет SCENE_NUM.

3.2.4. Если у группы есть привязанный датчик освещённости, включение сцены переводит группу в режим поддержания целевой освещённости.

### 3.3. Включение/выключение режима АВТО

3.3.1. **У локации**: приложение отправляет телеграмму с изменением **LOCATIONS[i].IS_AUTO** = `T` или `F`.

3.3.2. **У контроллера**: приложение отправляет телеграмму с изменением **CONTROLLERS.IS_AUTO** = `T` или `F`.

3.3.3. Если АВТО выключается — датчики перестают влиять на освещение. Если АВТО включается — датчики начинают отрабатывать действия.

