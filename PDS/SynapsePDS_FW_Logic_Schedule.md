# Прошивка. Логика работы. Работа по расписанию

АПК Синапс v1.0. ПО. Спецификации на разработку

**Последнее изменение:** 12.12.2025, 12:26 МСК

## 1. Назначение документа

Описать логику автоматической работы прошивки контроллера по расписанию.

## 2. Базовые документы

- **SynapsePDS_FW_Logic** — базовые принципы логики работы прошивки
- **SynapsePDS_FW_DB** — структура базы данных прошивки
- **SynapsePDS_USML** — протокол обмена данными

## 3. Работа по расписанию

### 3.1. Проверка событий

3.1.1. Если **CONTROLLERS.IS_SCHEDULE** = `T`, прошивка каждую минуту проверяет события в таблице **EVENTS**.

3.1.2. Прошивка сравнивает текущее время и день недели с данными в записях **EVENTS**.

3.1.3. Если время и день совпадают:
- Прошивка выполняет действие **EVENTS[i].ACTION_ID**.

### 3.2. Типы событий

3.2.1. **Ежедневное событие**: **EVENTS[i].DAYS** = 'FFFFFFF' (все дни F).

3.2.2. **Событие по дням недели**: **EVENTS[i].DAYS** содержит T в соответствующих днях (например, 'FFTFFFF' — вторник).

3.2.3. Если на одно время назначено ежедневное событие и событие по дням недели:
- Сначала выполняется ежедневное;
- Затем выполняется событие по дням недели.

### 3.3. Режим выполнения

3.3.1. **Одномоментное выполнение** (**EVENTS[i].SMOOTH** = `F`):
- Параметры устройств меняются сразу;
- Прошивка отправляет DALI-команды с параметрами из действия.

3.3.2. **Плавное выполнение** (**EVENTS[i].SMOOTH** = `T`):
- Параметры устройств изменяются линейно от текущих к целевым;
- Изменение производится раз в 1 минуту;
- Прошивка вычисляет шаг изменения и постепенно меняет параметры.

### 3.4. Выполнение действия

3.4.1. Действие состоит из одного или нескольких поддействий (**SUBACTIONS**).

3.4.2. Прошивка последовательно выполняет все поддействия действия:
- Включение сцены (DALI-команда + обновление FW-USM);
- Установка температуры TW (DALI-команда + обновление FW-USM);
- Переключение АВТО (обновление FW-USM).

3.4.3. После выполнения действия прошивка рассылает изменения всем телефонам.

