# Прошивка. Логика работы. Работа по расписанию

АПК Синапс v1.0. ПО. Спецификации на разработку

**Последнее изменение:** 14.12.2025, 13:26 МСК

## 1. Проверка событий

1.1. Если **CONTROLLERS.IS_SCHEDULE** = `1`, прошивка каждую минуту проверяет события в таблице **EVENTS**.

1.2. Прошивка сравнивает текущее время и день недели (время контроллера) с данными в записях **EVENTS**.

1.3. Если время и день совпадают, прошивка выполняет действие **EVENTS[i].ACTION_ID**.

## 2. Типы событий

2.1. **Ежедневное событие**: **EVENTS[i].DAYS** = 'TTTTTTT' (все дни T).

2.2. **Событие по дням недели**: **EVENTS[i].DAYS** содержит T в соответствующих днях (например, 'FFTFFFF' — вторник).

2.3. Если на одно время назначено ежедневное событие и событие по дням недели:
- Сначала выполняется ежедневное;
- Затем выполняется событие по дням недели.

2.4. Назначать на одно время больше одного ежедневного события и больше одного события по дням недели нельзя.

## 3. Режим выполнения

3.1. **Одномоментное выполнение** (**EVENTS[i].SMOOTH** = `0`):
- Параметры устройств меняются сразу;
- Прошивка отправляет DALI-команды с параметрами из действия, меняет FW-USM, отправляет телегу приложению.

3.2. **Плавное выполнение** (**EVENTS[i].SMOOTH** = `1`):
- Параметры устройств изменяются линейно от текущих к целевым;
- Текущими параметрами могут быть и пареметры, которые пользователь поменял вручную.
- Изменение производится раз в 1 минуту;
- Прошивка вычисляет шаг изменения и постепенно меняет параметры.
- Прошивка при каждом минутном шаге отправляет DALI-команды с параметрами из действия, меняет FW-USM, отправляет телегу приложению.

